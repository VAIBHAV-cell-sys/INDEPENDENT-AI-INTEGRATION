<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Challenge Navigator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding: 40px;
      background: #f9f9f9;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .form-group label {
      font-weight: 500;
    }
    #responseBox {
      white-space: pre-wrap;
      background: #f1f1f1;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
    }
    .challenge-item {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4">üß† Challenge Navigator</h2>

    <!-- Model Setup -->
    <div class="form-group">
      <label for="llmSelector">Select LLM Provider</label>
      <select id="llmSelector" class="form-control">
        <option value="local_llama">Local LLaMA</option>
        <option value="openai">OpenAI</option>
        <option value="perplexity">Perplexity AI</option>
        <option value="deepseek">DeepSeek AI</option>
        <option value="aimlapi">AIMLAPI</option> <!-- ‚úÖ FIXED: was 'deepseek' before -->
      </select>
    </div>

    <div class="form-group">
      <label for="apiKey">API Key (if needed)</label>
      <input type="password" class="form-control" id="apiKey" placeholder="Enter API key if required">
    </div>

    <button class="btn btn-secondary mb-4" onclick="setModel()">Set Model</button>

    <!-- Goal Input -->
    <div class="form-group">
      <label for="goalInput">üéØ What‚Äôs your goal?</label>
      <input type="text" class="form-control" id="goalInput" placeholder="e.g., Start a YouTube Channel">
    </div>
    <button class="btn btn-primary mb-3" onclick="generateChallenges()">Generate Challenges</button>

    <!-- Challenges -->
    <div id="challengeSection" style="display:none;">
      <h5>üõ†Ô∏è Select up to 5 challenges:</h5>
      <div id="challengeList" class="mb-3"></div>
      <button class="btn btn-success" onclick="generatePlan()">Generate Action Plan</button>
    </div>

    <!-- Plan Output -->
    <div id="responseBox" style="display:none;" class="mt-4"></div>
  </div>

  <script>
    async function setModel() {
      const llm = document.getElementById("llmSelector").value;
      const apiKey = document.getElementById("apiKey").value;

      await fetch("/set_model", {
        method: "POST",
        body: new URLSearchParams({ model: llm, api_key: apiKey }),
        headers: { "Content-Type": "application/x-www-form-urlencoded" }
      });

      alert("‚úÖ Model set successfully!");
    }

    async function generateChallenges() {
      const goal = document.getElementById("goalInput").value.trim();
      const challengeList = document.getElementById("challengeList");
      const responseBox = document.getElementById("responseBox");

      if (!goal) return alert("‚ùó Please enter a goal.");

      responseBox.style.display = "block";
      responseBox.innerText = "Generating challenges... ‚è≥";

      const res = await fetch("/generate_challenges", {
        method: "POST",
        body: new URLSearchParams({ goal }),
        headers: { "Content-Type": "application/x-www-form-urlencoded" }
      });

      const data = await res.json();
      const challenges = data.challenges || [];

      if (!challenges.length) {
        responseBox.innerText = " No challenges found. Try rephrasing your goal.";
        return;
      }

      challengeList.innerHTML = "";
      challenges.forEach((challenge, i) => {
        const wrapper = document.createElement("div");
        wrapper.className = "form-check challenge-item";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className = "form-check-input";
        checkbox.id = `ch${i}`;
        checkbox.value = challenge;
        checkbox.addEventListener("change", limitCheckboxes);

        const label = document.createElement("label");
        label.className = "form-check-label";
        label.setAttribute("for", `ch${i}`);
        label.innerText = challenge;

        wrapper.appendChild(checkbox);
        wrapper.appendChild(label);
        challengeList.appendChild(wrapper);
      });

      document.getElementById("challengeSection").style.display = "block";
      responseBox.style.display = "none";
    }

    function limitCheckboxes() {
      const checked = document.querySelectorAll("#challengeList input:checked");
      if (checked.length > 5) {
        this.checked = false;
        alert("‚ö†Ô∏è Please select up to 5 challenges only.");
      }
    }

    async function generatePlan() {
      const selected = Array.from(document.querySelectorAll("#challengeList input:checked"))
        .map(cb => cb.value.trim());

      if (selected.length === 0) {
        alert("‚ö†Ô∏è Select at least one challenge.");
        return;
      }

      const responseBox = document.getElementById("responseBox");
      responseBox.style.display = "block";
      responseBox.innerText = "Generating action plan... ‚è≥";

      const formBody = new URLSearchParams();
      selected.forEach(ch => formBody.append("challenges[]", ch));

      const res = await fetch("/generate_plan", {
        method: "POST",
        body: formBody,
        headers: { "Content-Type": "application/x-www-form-urlencoded" }
      });

      const data = await res.json();
      responseBox.innerText = data.plan || "‚ùå No plan received.";
    }
  </script>
</body>
</html>
